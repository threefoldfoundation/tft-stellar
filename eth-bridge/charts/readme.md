# Deploying Stellar Bridge

Deployment requirements for TFT stellar bridge.

- Stellar multisig account
    - consisting of X stellar keys
- Smart chain multisig account
    - consisting of X smart chain accounts
- TFT Contract on the target smart chain

## Prerequisites

### Stellar Multisig account

Create a Stellar multisignature account with X signers. The amount of signers will define how much instances of the bridge you should run.

[Multisig docs](https://developers.stellar.org/docs/glossary/multisig/)

Save the contract address for later usage in the bridge deployment.

### Smart Chain Multisignature contract

Create a smart chain contract consisting of the same amount of signers of the stellar multisig account.

To create a smart chain account use the `geth` binary.

Example for Binance smart chain:

1: clone [source](https://github.com/binance-chain/bsc)
2: run `make geth`
3: create an account: `./build/bin/geth account new`
4: account json should be placed in `~/.ethereum/keystore`

Use X account keys to create the multisnature contract.

The multisig contract should be deployed on the target smart chain. You can deploy the contract by uploading the [source code](https://github.com/threefoldfoundation/tft/tree/main/solidity/multisig) to [remix](https://remix.ethereum.org/#optimize=false&runs=200&evmVersion=null&version=soljson-v0.8.3+commit.8d00100c.js).

Save the multisig contract address for later usage in the bridge deployment.

### Smart Chain TFT Token Contract

The TFT token contract should be deployed on the target smart chain. You can deploy the contract by uploading the [source code](https://github.com/threefoldfoundation/tft/tree/main/solidity/contract) to [remix](https://remix.ethereum.org/#optimize=false&runs=200&evmVersion=null&version=soljson-v0.8.3+commit.8d00100c.js).

Simply upload all the files and compile it with solidity 8+. Then deploy it on chain.

If both the Multisig contract and token contract are deployed you must make the Multisig contract owner of the TFT contract.

## Running the bridge

### Env variables

|Name|Description|Example
|---|---|---
|stellar_secret|on of X stellar multisignature keys|
|account_json|json key generated by geth|
|account_password|json key password|
|eth_client_url|Smart chain client url|https://data-seed-prebsc-1-s1.binance.org:8545/
|eth_network|Smart chain network|smart-chain-testnet
|contract_address|TFT token address on chain|0x770b0AA8b5B4f140cdA2F4d77205ceBe5f3D3C7e
|ms_contract_address|Multisig token address on chain|0x8a511F1C6C94B051A6CFCF0FdC83e7FA37CF687F
|is_follower|If bridge is follower (signer)|false
|volume.hostPath (datadir)|Datadir where chain data is stored|/storage

Account json in the values file is the account json file as json.

### install

`helm install master-bridge bridge`